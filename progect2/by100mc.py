"""
Производит интерполяцию исходной последовательности RR-интервалов, и выводит значения графика через каждые
100 миллисекунд.
Интерполяция проводится путём линейных сплайнов, мировые стандарты - кубическая интерполяция, поэтому нужно переделать
"""


def approximate(x, y):
    # Приписывает после координат точек (всех, кроме последней по оси Ox) значения
    # линейных функций (A, B, C: Ax+By+C = 0) между ней и первой точкой (по Ox), встерчающейся справа
    x1, y1 = x
    x2, y2 = y
    return [y1 - y2, x2 - x1, x1 * y2 - x2 * y1]


def return_y(x, points):  # x - координата по х
    # Возвращение f(x)
    for i in range(len(points[:-1])):
        if points[i+1][0] > x > points[i][0]:
            return (points[i][2]*x + points[i][4]) / (-points[i][3])
        elif x == points[i][0]:
            return (points[i][1])
        elif x == points[i + 1][0]:
            return (points[i + 1][1])


# график rr - интервалов
rr_intervals = [0.814, 0.811, 0.789, 0.792, 0.789, 0.817, 0.653, 0.994, 0.844, 0.811, 0.789, 0.772, 0.839, 0.856, 0.822, 0.828, 0.822, 0.794, 0.797, 0.792, 0.822, 0.869, 0.822, 0.786, 0.792, 0.775, 0.786, 0.811, 0.817, 0.828, 0.844, 0.806, 0.775, 0.8, 0.789, 0.858, 0.842, 0.825, 0.803, 0.836, 0.792, 0.789, 0.819, 0.844, 0.881, 0.822, 0.778, 0.803, 0.811, 0.797, 0.836, 0.831, 0.825, 0.811, 0.789, 0.781, 0.808, 0.842, 0.833, 0.831, 0.806, 0.778, 0.797, 0.781, 0.792, 0.856, 0.847, 0.822, 0.783, 0.786, 0.786, 0.817, 0.811, 0.85, 0.833, 0.811, 0.783, 0.772, 0.786, 0.803, 0.842, 0.825, 0.811, 0.778, 0.8, 0.789, 0.8, 0.817, 0.858, 0.831, 0.786, 0.783, 0.792, 0.831, 0.825, 0.831, 0.831, 0.822, 0.797, 0.778, 0.794, 0.814, 0.858, 0.847, 0.811, 0.794, 0.786, 0.797, 0.811, 0.825, 0.847, 0.853, 0.808, 0.767, 0.8, 0.803, 0.817, 0.836, 0.819, 0.828, 0.797, 0.781, 0.778, 0.814, 0.822, 0.864, 0.831, 0.789, 0.786, 0.803, 0.792, 0.819, 0.831, 0.839, 0.819, 0.772, 0.753, 0.794, 0.819, 0.814, 0.836, 0.822, 0.783, 0.744, 0.831, 0.781, 0.831, 0.864, 0.822, 0.803, 0.778, 0.786, 0.8, 0.797, 0.814, 0.847, 0.825, 0.775, 0.761, 0.781, 0.772, 0.825, 0.828, 0.797, 0.786, 0.789, 0.778, 0.761, 0.786, 0.819, 0.847, 0.808, 0.769, 0.778, 0.792, 0.786, 0.797, 0.819, 0.819, 0.806, 0.772, 0.775, 0.772, 0.806, 0.811, 0.822, 0.8, 0.769, 0.778, 0.775, 0.783, 0.786, 0.831, 0.819, 0.783, 0.753, 0.772, 0.783, 0.792, 0.811, 0.828, 0.828, 0.803, 0.769, 0.769, 0.8, 0.819, 0.836, 0.839, 0.8, 0.794, 0.803, 0.786, 0.789, 0.833, 0.847, 0.839, 0.789, 0.758, 0.797, 0.806, 0.814, 0.819, 0.828, 0.806, 0.794, 0.778, 0.769, 0.825, 0.522, 0.939, 0.844, 0.817, 0.775, 0.819, 0.811, 0.811, 0.847, 0.867, 0.814, 0.769, 0.789, 0.794, 0.828, 0.831, 0.831, 0.85, 0.814, 0.775, 0.794, 0.819, 0.842, 0.861, 0.833, 0.792, 0.797, 0.789, 0.608, 0.961, 0.833, 0.839, 0.831, 0.783, 0.75, 0.803, 0.811, 0.825, 0.808, 0.825, 0.8, 0.792, 0.767, 0.794, 0.842, 0.839, 0.831, 0.814, 0.792, 0.789, 0.797, 0.808, 0.833, 0.847, 0.836, 0.808, 0.783, 0.786, 0.839, 0.858, 0.844, 0.839, 0.836, 0.814, 0.769, 0.806, 0.836, 0.853, 0.839, 0.831, 0.792, 0.8, 0.803, 0.808, 0.828, 0.844, 0.836, 0.794, 0.783, 0.792, 0.828, 0.844, 0.819, 0.847, 0.808, 0.778, 0.792, 0.811, 0.819, 0.864, 0.839, 0.8, 0.806, 0.772, 0.814, 0.828, 0.842, 0.839, 0.856, 0.797, 0.772, 0.775, 0.822, 0.844, 0.828, 0.822, 0.811, 0.811, 0.778, 0.781, 0.819, 0.828, 0.547, 0.975, 0.8, 0.772, 0.792, 0.806, 0.806, 0.811, 0.8, 0.814, 0.783, 0.769, 0.781, 0.825, 0.828, 0.819, 0.825, 0.789, 0.792, 0.8, 0.803, 0.833, 0.856, 0.831, 0.794, 0.783, 0.769, 0.817, 0.825]
print(sum(rr_intervals))
result = []
for i in [int(i * 1000) for i in rr_intervals]:
    if not len(result):
        result.append([0, i])
        continue
    if len(result) == 1:
        result.append([result[0][1], i])
    else:
        result.append([result[-1][0] + result[-1][1], i])

for i in range(len(result[:-1])):
    result[i] += approximate(result[i], result[i + 1])
print(result)

counting = []
k = 0
while k * 100 < sum([int(i * 1000) for i in rr_intervals]):
    counting.append((return_y(k * 100, result)))
    k += 1
print(len(counting))  # отсчёты через 100 мс начиная с 0
